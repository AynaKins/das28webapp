<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>DAS28 –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f7fafc; color: #222;}
        h1 { font-size: 1.4em; margin-bottom: 0.4em;}
        .section { background: #fff; border-radius: 8px; padding: 15px 20px; margin-bottom: 18px; box-shadow: 0 2px 12px #0001;}
        .joints { display: flex; gap: 24px; flex-wrap: wrap;}
        .joint-group { min-width: 180px;}
        .joint-group h3 { margin: 10px 0 6px 0; font-size: 1em;}
        .checkbox-list { display: flex; flex-wrap: wrap; gap: 6px; }
        .checkbox-list label { display: flex; align-items: center; margin-right: 10px; }
        .controls { margin-top: 6px;}
        input[type="number"] { width: 70px; padding: 4px; border-radius: 5px; border: 1px solid #bbb;}
        .result { font-size: 1.2em; margin-top: 12px; background: #e9fbe3; padding: 8px 14px; border-radius: 8px;}
        button { background: #36b37e; color: #fff; border: none; border-radius: 5px; padding: 9px 16px; font-size: 1em; margin: 8px 0; cursor: pointer; transition: background 0.2s;}
        button:active { background: #289965; }
        .footer { margin-top: 18px; font-size: 0.9em; color: #666;}
        .small-btn { font-size: 0.9em; padding: 5px 9px; background: #ececec; color: #222; border: 1px solid #bbb; margin-right: 7px;}
        .small-btn:active { background: #ddd;}
        .webapp-btn { background: #2185d0; margin-top: 16px;}
    </style>
</head>
<body>
    <h1>–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è DAS-28</h1>
    <div class="section">
        <b>–°–û–≠ (–º–º/—á):</b>
        <input type="number" id="soe" min="1" max="200" value="30" />
        <b>GH (0-100):</b>
        <input type="number" id="gh" min="0" max="100" value="50" />
    </div>
    <div class="section">
        <b>–ß–∏—Å–ª–æ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã—Ö —Å—É—Å—Ç–∞–≤–æ–≤ (–ß–ë–°):</b>
        <div class="joints" id="tender-joints"></div>
        <div class="controls">
            <button class="small-btn" onclick="toggleAll('tender', true)">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
            <button class="small-btn" onclick="toggleAll('tender', false)">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <span id="tender-count">–ß–ë–°: 0</span>
        </div>
    </div>
    <div class="section">
        <b>–ß–∏—Å–ª–æ –ø—Ä–∏–ø—É—Ö—à–∏—Ö —Å—É—Å—Ç–∞–≤–æ–≤ (–ß–ü–°):</b>
        <div class="joints" id="swollen-joints"></div>
        <div class="controls">
            <button class="small-btn" onclick="toggleAll('swollen', true)">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
            <button class="small-btn" onclick="toggleAll('swollen', false)">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <span id="swollen-count">–ß–ü–°: 0</span>
        </div>
    </div>
    <div class="section result" id="result-section">
        DAS28: <b id="das28">‚Äî</b><br>
        <span id="das28-interpret"></span>
    </div>
    <button class="webapp-btn" onclick="sendToTelegram()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Telegram</button>

    <div class="footer">
        DAS28 = (0.56 √ó ‚àö–ß–ë–°) + (0.28 √ó ‚àö–ß–ü–°) + (0.70 √ó ln(–°–û–≠)) + (0.014 √ó GH)<br>
        DAS28 &lt; 2.6 ‚Äî —Ä–µ–º–∏—Å—Å–∏—è, 2.6‚Äì3.2 ‚Äî –Ω–∏–∑–∫–∞—è, 3.2‚Äì5.1 ‚Äî —É–º–µ—Ä–µ–Ω–Ω–∞—è, &gt;5.1 ‚Äî –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    </div>
    <script>
        // –°–ø–∏—Å–æ–∫ —Å—É—Å—Ç–∞–≤–æ–≤ (–µ–¥–∏–Ω—ã–π –¥–ª—è –æ–±–µ–∏—Ö –≥—Ä—É–ø–ø)
        const jointGroups = [
            { name: '–ü–ª–µ—á–æ', joints: ['–ü—Ä–∞–≤–æ–µ –ø–ª–µ—á–æ', '–õ–µ–≤–æ–µ –ø–ª–µ—á–æ'] },
            { name: '–õ–æ–∫–æ—Ç—å', joints: ['–ü—Ä–∞–≤—ã–π –ª–æ–∫–æ—Ç—å', '–õ–µ–≤—ã–π –ª–æ–∫–æ—Ç—å'] },
            { name: '–ó–∞–ø—è—Å—Ç—å–µ', joints: ['–ü—Ä–∞–≤–æ–µ –∑–∞–ø—è—Å—Ç—å–µ', '–õ–µ–≤–æ–µ –∑–∞–ø—è—Å—Ç—å–µ'] },
            { name: 'MCP 1-5', joints: ['–ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ MCP 1', 'MCP 2', 'MCP 3', 'MCP 4', 'MCP 5',
                                         '–õ–µ–≤–∞—è —Ä—É–∫–∞ MCP 1', 'MCP 2', 'MCP 3', 'MCP 4', 'MCP 5'] },
            { name: 'IP 1, PIP 2-5', joints: ['–ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ IP 1', 'PIP 2', 'PIP 3', 'PIP 4', 'PIP 5',
                                              '–õ–µ–≤–∞—è —Ä—É–∫–∞ IP 1', 'PIP 2', 'PIP 3', 'PIP 4', 'PIP 5'] },
            { name: '–ö–æ–ª–µ–Ω–æ', joints: ['–ü—Ä–∞–≤–æ–µ –∫–æ–ª–µ–Ω–æ', '–õ–µ–≤–æ–µ –∫–æ–ª–µ–Ω–æ'] },
        ];
        function renderJoints(type) {
            let container = document.getElementById(type+'-joints');
            container.innerHTML = '';
            jointGroups.forEach(group => {
                let div = document.createElement('div');
                div.className = 'joint-group';
                let title = document.createElement('h3');
                title.innerText = group.name;
                div.appendChild(title);
                let clist = document.createElement('div');
                clist.className = 'checkbox-list';
                group.joints.forEach(joint => {
                    let id = type + '-' + joint.replace(/\s/g,'_');
                    let label = document.createElement('label');
                    let box = document.createElement('input');
                    box.type = 'checkbox';
                    box.id = id;
                    box.dataset.type = type;
                    box.onclick = recalcAll;
                    label.appendChild(box);
                    label.append(' ' + joint);
                    clist.appendChild(label);
                });
                div.appendChild(clist);
                container.appendChild(div);
            });
        }
        renderJoints('tender');
        renderJoints('swollen');
        function getCount(type) {
            return document.querySelectorAll(`input[type="checkbox"][data-type="${type}"]:checked`).length;
        }
        function toggleAll(type, checked) {
            document.querySelectorAll(`input[type="checkbox"][data-type="${type}"]`).forEach(c => c.checked = checked);
            recalcAll();
        }
        function recalcAll() {
            let tender = getCount('tender');
            let swollen = getCount('swollen');
            document.getElementById('tender-count').innerText = '–ß–ë–°: ' + tender;
            document.getElementById('swollen-count').innerText = '–ß–ü–°: ' + swollen;
            calcDas28();
        }
        function calcDas28() {
            let tender = getCount('tender');
            let swollen = getCount('swollen');
            let soe = parseFloat(document.getElementById('soe').value.replace(',','.')) || 0;
            let gh = parseFloat(document.getElementById('gh').value.replace(',','.')) || 0;
            let das28 = '‚Äî', interpret = '';
            if (tender >= 0 && swollen >= 0 && soe > 0 && gh >= 0) {
                das28 = 0.56 * Math.sqrt(tender)
                       + 0.28 * Math.sqrt(swollen)
                       + 0.70 * Math.log(soe)
                       + 0.014 * gh;
                das28 = Math.round(das28 * 100) / 100;
                if (das28 < 2.6) interpret = 'üü¢ –†–µ–º–∏—Å—Å–∏—è';
                else if (das28 <= 3.2) interpret = 'üü° –ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å';
                else if (das28 <= 5.1) interpret = 'üü† –£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å';
                else interpret = 'üî¥ –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å';
            }
            document.getElementById('das28').innerText = das28;
            document.getElementById('das28-interpret').innerText = interpret;
        }
        document.getElementById('soe').oninput = calcDas28;
        document.getElementById('gh').oninput = calcDas28;

        // === Telegram WebApp send ===
        function sendToTelegram() {
            let tenderJoints = [];
            let swollenJoints = [];
            document.querySelectorAll('input[type="checkbox"][data-type="tender"]').forEach((c,i) => {
                if (c.checked) tenderJoints.push(c.nextSibling.nodeValue.trim());
            });
            document.querySelectorAll('input[type="checkbox"][data-type="swollen"]').forEach((c,i) => {
                if (c.checked) swollenJoints.push(c.nextSibling.nodeValue.trim());
            });
            let soe = parseFloat(document.getElementById('soe').value.replace(',','.')) || 0;
            let gh = parseFloat(document.getElementById('gh').value.replace(',','.')) || 0;
            let das28 = document.getElementById('das28').innerText;
            let interpret = document.getElementById('das28-interpret').innerText;
            let data = {
                soe, gh,
                tender: tenderJoints.length,
                swollen: swollenJoints.length,
                tenderJoints, swollenJoints,
                das28, interpret
            };
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify(data));
            } else {
                alert("WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø—É—Å–∫ –∏–∑ Telegram.");
            }
        }
        recalcAll();
    </script>
</body>
</html>
